<%= provide(:title, "総勘定元帳(#{@param_account_title})") %>

<h2>総勘定元帳【<%= @param_account_title %>】</h2>

<div>
  <table class="table table-bordered table-condensed table-hover" id="table-account">
    <thead>
      <tr>
        <th>日付</th>
        <th>相手勘定科目</th>
        <th>摘要</th>
        <th>借方金額</th>
        <th>貸方金額</th>
        <th>残高</th>
        <th>仕訳帳</th>
      </tr>
    </thead>
    <tbody>
      <% balance = 0 %>
      <% @general_ledger_accounts.each do |account| %>
        <tr>
          <td><%= l(account.accounting_date, format: :short) %></td>
          <!--<th>相手勘定科目</th>-->
          <td>
            <% if account.compound_journals.count < 2 %>
              <% account.compound_journals.each do |compound_journal| %>
                <% if compound_journal.account_title == @param_account_title %>
                  <%= compound_journal.right_account_title %>
                <% elsif compound_journal.right_account_title == @param_account_title %>
                  <%= compound_journal.account_title %>
                <% end %>
              <% end %>
            <% else %>
              諸口
            <% end %>
          </td>
          <!--<th>摘要</th>-->
          <td>
            <% account.compound_journals.each do |compound_journal| %>
              <% if compound_journal.account_title == @param_account_title %>
                <%= compound_journal.description %></br>
              <% end %>
            <% end %>
          </td>
          <!--<th>借方金額</th>-->
          <td>
            <% account.compound_journals.each do |compound_journal| %>
              <% if compound_journal.account_title == @param_account_title %>
                <%= compound_journal.amount %></br>
              <% end %>
            <% end %>
          </td>
          <!--<th>貸方金額</th>-->
          <td>
            <% account.compound_journals.each do |compound_journal| %>
              <% if compound_journal.right_sub_account_title == @param_account_title %>
                <%= compound_journal.right_amount %></br>
              <% end %>
            <% end %>
          </td>
          <!--<th>残高</th>-->
          <td>
            <% account.compound_journals.each do |compound_journal| %>
              <% if compound_journal.sub_account_title == @param_account_title %>
                <% balance += compound_journal.amount.to_i %>
                <%= balance %></br>
              <% elsif compound_journal.right_sub_account_title == @param_account_title %>
                <% balance -= compound_journal.right_amount.to_i %>
                <%= balance %></br>
              <% end %>
            <% end %>
          </td>
          <!--<th>仕訳帳</th>-->
          <td>
            <%= link_to "仕訳帳へ", journal_books_accounts_path(accounting_date: account.accounting_date), class: "btn btn-info" %>
          </td>
          
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
